<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1, shrink-to-fit=no">	
<title>爱“拼”才有新希望</title>
<link rel="stylesheet" type="text/css" href="css/basic.css">
<link rel="stylesheet" type="text/css" href="css/index.css">

<!-- 	<script type="text/javascript">
window.screen.lockOrientation([“landscape-primary”,“landscape-secondary”]);
</script> -->
</head>
<body class="relative">
<section class="p0">
	<p class="percent">0%</p>

	<div class="p0-d1 relative">
		<img class="p0-4 q20" src="images/p0-4.png">
		<img class="p0-1 q11" src="images/p0-1.png">
		<img class="p0-4 q56" src="images/p0-4.png">
		<img class="p0-1 q36" src="images/p0-1.png">
		<img class="p0-4 q4"  src="images/p0-4.png">
	</div>
	<div class="p0-d2 relative">
		<img class="p0-3 q1" src="images/p0-3.png">
		<img class="p0-2 q34" src="images/p0-2.png">
		<img class="p0-1 q28" src="images/p0-1.png">
		<img class="p0-2 q44" src="images/p0-2.png">
		<img class="p0-3 q12" src="images/p0-3.png" style="transform:translate(calc(-3.1vw),calc(-3.1vw)) rotate(180deg);">
	</div>
	<div class="p0-d3 relative">
		<img class="p0-2 q6" src="images/p0-2.png">
		<img class="p0-1 q18" src="images/p0-1.png">
		<img class="p0-2 q22" src="images/p0-2.png">
		<img class="p0-1 q41" src="images/p0-1.png">
		<img class="p0-2 q62" src="images/p0-2.png">
	</div>
	<div class="p0-d2 relative">
		<img class="p0-3 q10" src="images/p0-3.png">
		<img class="p0-2 q42" src="images/p0-2.png">
		<img class="p0-1 q13" src="images/p0-1.png">
		<img class="p0-2 q26" src="images/p0-2.png">
		<img class="p0-3 q55" src="images/p0-3.png" style="transform:translate(calc(-3.1vw),calc(-3.1vw)) rotate(180deg);">
	</div>
	<div class="p0-d3 relative">
		<img class="p0-2 q61" src="images/p0-2.png">
		<img class="p0-1 q83" src="images/p0-1.png">
		<img class="p0-2 q36" src="images/p0-2.png">
		<img class="p0-1 q6" src="images/p0-1.png">
		<img class="p0-2 q11" src="images/p0-2.png">
	</div>
	<div class="p0-d2 relative">
		<img class="p0-3 q43" src="images/p0-3.png">
		<img class="p0-2 q66" src="images/p0-2.png">
		<img class="p0-1 q33" src="images/p0-1.png">
		<img class="p0-2 q90" src="images/p0-2.png">
		<img class="p0-3 q3" src="images/p0-3.png" style="transform:translate(calc(-3.1vw),calc(-3.1vw)) rotate(180deg);">
	</div>
	<div class="p0-d3 relative">
		<img class="p0-2 q36" src="images/p0-2.png">
		<img class="p0-1 q48" src="images/p0-1.png">
		<img class="p0-2 q94" src="images/p0-2.png">
		<img class="p0-1 q77" src="images/p0-1.png">
		<img class="p0-2 q8" src="images/p0-2.png">
	</div>
	<div class="p0-d2 relative">
		<img class="p0-3 q39" src="images/p0-3.png">
		<img class="p0-2 q21" src="images/p0-2.png">
		<img class="p0-1 q3" src="images/p0-1.png">
		<img class="p0-2 q63" src="images/p0-2.png">
		<img class="p0-3 q71" src="images/p0-3.png" style="transform:translate(calc(-3.1vw),calc(-3.1vw)) rotate(180deg);">
	</div>
	<div class="p0-d3 relative">
		<img class="p0-2 q82" src="images/p0-2.png">
		<img class="p0-1 q20" src="images/p0-1.png">
		<img class="p0-2 q97" src="images/p0-2.png">
		<img class="p0-1 q30" src="images/p0-1.png">
		<img class="p0-2 q15" src="images/p0-2.png">
	</div>
	<div class="p0-d2 relative">
		<img class="p0-3 q52" src="images/p0-3.png">
		<img class="p0-2 q37" src="images/p0-2.png">
		<img class="p0-1 q81" src="images/p0-1.png">
		<img class="p0-2 q72" src="images/p0-2.png">
		<img class="p0-3 q28" src="images/p0-3.png" style="transform:translate(calc(-3.1vw),calc(-3.1vw)) rotate(180deg);">
	</div>
	<div class="p0-d3 relative">
		<img class="p0-2 q8" src="images/p0-2.png">
		<img class="p0-1 q29" src="images/p0-1.png">
		<img class="p0-2 q58" src="images/p0-2.png">
		<img class="p0-1 q81" src="images/p0-1.png">
		<img class="p0-2 q35" src="images/p0-2.png">
	</div>
	<img src="images/p0-0.png" class="p0-0 ">
	
</section>
<section class="p1 hide">
	<img src="images/p1-1.png" class="p1-1">
	<img src="images/p1-2.png" class="p1-2">
	<img src="images/p1-3.png" class="p1-3">
	<img src="images/p1-4.png" class="p1-4">
	<img src="images/p1-5.png" class="p1-5">
</section>
<section class="p2 hide">
	<img src="images/p2-0.png" class="p2-0">
	<img src="images/p2-1.png" class="p2-1">
	<img src="images/p2-2.png" class="p2-2">
</section>
<section class="p3 hide">
	<img src="images/p3-0.png" class="p3-0">
	<img src="images/p3-1.png" class="p3-1">
	<div>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
		<span></span>
	</div>
</section>
<section class="p4 hide">
	<div class="info_box absolute hide">
		<img src="images/p5-0.png" class="p5-0">
		<p class="wx_name">你好</p>
		<div class="projess relative"><div class="remain absolute"></div><span class="time absolute">剩余时间</span></div>
	</div>

	<div class="p4-box">
		<img class="t0">
		
		<div class="mask absolute hide"></div>
		<img class="suipian t1 absolute hide" >
		<img class="suipian t2 absolute hide" >
		<img class="suipian t3 absolute hide" >
		<img class="suipian t4 absolute hide" >
		<img class="suipian t5 absolute hide" >
		<img class="suipian t6 absolute hide" >
		<img class="suipian t7 absolute hide" >
		<img class="suipian t8 absolute hide" >
		<img class="suipian t9 absolute hide" >
	</div>
	<!-- <div class="p4-box start">开始拼图</div> -->
	<img class="num hide" src="images/p4-3.png">
	<img class="t10 absolute hide" src="images/t1-10.png">
	<div class="fail hide">
		<img class="p5-1" src="images/p5-1.png">
		<img class="p5-2" src="images/p5-2.png">
	</div>
	<div class="success hide">
		<img class="t11" src="images/t1-11.png">
		<img class="p5-2" src="images/p5-2.png">
		<img class="p5-3" src="images/p5-3.png">
	</div>
</section>
<section class="p5 hide">
	<img class="p5-4" src="images/p5-4.png">
</section>

<section class="p6 hide">
	<img class="p6-0 absolute" src="images/p6-0.png">
</section>
<section class="p7 hide">
	<img class="p7-1" src="images/p7-1.png">
	<img class="p7-2" src="images/p7-2.png">

	<img class="p7-6 absolute hide" src="images/p7-6.png">
	<div class="money_num absolute hide">0.0<span> 元</span></div>
</section>
<section class="p8 hide">
	<img class="p8-1" src="images/p8-1.png">
	<img class="p8-3 pj" src="images/p8-3.png">
	<img class="p8-4 pj hide" src="images/p8-4.png">
	<img class="p8-5 pj hide" src="images/p8-5.png">
	<img class="p8-2" src="images/p8-2.png">
</section>
<section class="p9 hide">
	<img class="p9-1" src="images/p9-1.png">
	<img class="p9-2" src="images/p9-2.png">
</section>
<span class="music absolute">
	<img class="music-true" src="images/music.png">
	<img class="music-false hide" src="images/musicNo.png">
</span>
<script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="js/lin.js"></script>
<script type="text/javascript" src="js/jweixin-1.2.0.js"></script>
<script type="text/javascript" src="js/ldmjssdk.js"></script>

<script type="text/javascript">
//预加载
	var sucai = new Array();
	var Src = [
		"images/p0-0.png",
		"images/p0-1.png",
		"images/p0-2.png",
		"images/p0-3.png",
		"images/p0-4.png",
		"images/p1-1.png",
		"images/p1-2.png",
		"images/p1-3.png",
		"images/p1-4.png",
		"images/p1-5.png",
		"images/p2-0.png",
		"images/p2-1.png",
		"images/p2-2.png",
		"images/p3-0.png",
		"images/p3-1.png",
		"images/p4-1.png",
		"images/p4-2.png",
		"images/p4-3.png",
		"images/p5-1.png",
		"images/p5-2.png",
		"images/p5-3.png",
		"images/p5-4.png",
		"images/p6-0.png",
		"images/p7-1.png",
		"images/p7-2.png",

		"images/p7-5.png",
		"images/p7-6.png",
		"images/p8-1.png",
		"images/p8-2.png",
		"images/p8-3.png",
		"images/p8-4.png",
		"images/p8-5.png",
		"images/p9-1.png",
		"images/p9-2.png",
		"images/t1-0.png",
		"images/t1-1.png",
		"images/t1-2.png",
		"images/t1-2.png",
		"images/t1-3.png",
		"images/t1-4.png",
		"images/t1-5.png",
		"images/t1-6.png",
		"images/t1-7.png",
		"images/t1-8.png",
		"images/t1-9.png",
		"images/t1-10.png",
		"images/t1-11.png",
				"images/t2-0.png",
		"images/t2-1.png",
		"images/t2-2.png",
		"images/t2-2.png",
		"images/t2-3.png",
		"images/t2-4.png",
		"images/t2-5.png",
		"images/t2-6.png",
		"images/t2-7.png",
		"images/t2-8.png",
		"images/t2-9.png",
		"images/t2-10.png",
		"images/t2-11.png",
				"images/t3-0.png",
		"images/t3-1.png",
		"images/t3-2.png",
		"images/t3-2.png",
		"images/t3-3.png",
		"images/t3-4.png",
		"images/t3-5.png",
		"images/t3-6.png",
		"images/t3-7.png",
		"images/t3-8.png",
		"images/t3-9.png",
		"images/t3-10.png",
		"images/t3-11.png",
				"images/t4-0.png",
		"images/t4-1.png",
		"images/t4-2.png",
		"images/t4-2.png",
		"images/t4-3.png",
		"images/t4-4.png",
		"images/t4-5.png",
		"images/t4-6.png",
		"images/t4-7.png",
		"images/t4-8.png",
		"images/t4-9.png",
		"images/t4-10.png",
		"images/t4-11.png",
				"images/t5-0.png",
		"images/t5-1.png",
		"images/t5-2.png",
		"images/t5-2.png",
		"images/t5-3.png",
		"images/t5-4.png",
		"images/t5-5.png",
		"images/t5-6.png",
		"images/t5-7.png",
		"images/t5-8.png",
		"images/t5-9.png",
		"images/t5-10.png",
		"images/t5-11.png",
				"images/t6-0.png",
		"images/t6-1.png",
		"images/t6-2.png",
		"images/t6-2.png",
		"images/t6-3.png",
		"images/t6-4.png",
		"images/t6-5.png",
		"images/t6-6.png",
		"images/t6-7.png",
		"images/t6-8.png",
		"images/t6-9.png",
		"images/t6-10.png",
		"images/t6-11.png",
				"images/t7-0.png",
		"images/t7-1.png",
		"images/t7-2.png",
		"images/t7-2.png",
		"images/t7-3.png",
		"images/t7-4.png",
		"images/t7-5.png",
		"images/t7-6.png",
		"images/t7-7.png",
		"images/t7-8.png",
		"images/t7-9.png",
		"images/t7-10.png",
		"images/t7-11.png",
				"images/t8-0.png",
		"images/t8-1.png",
		"images/t8-2.png",
		"images/t8-2.png",
		"images/t8-3.png",
		"images/t8-4.png",
		"images/t8-5.png",
		"images/t8-6.png",
		"images/t8-7.png",
		"images/t8-8.png",
		"images/t8-9.png",
		"images/t8-10.png",
		"images/t8-11.png",
				"images/t9-0.png",
		"images/t9-1.png",
		"images/t9-2.png",
		"images/t9-2.png",
		"images/t9-3.png",
		"images/t9-4.png",
		"images/t9-5.png",
		"images/t9-6.png",
		"images/t9-7.png",
		"images/t9-8.png",
		"images/t9-9.png",
		"images/t9-10.png",
		"images/t9-11.png",
	];

	//音乐
	var bgm = new Audio();
    bgm.src = "media/001.mp3";
	bgm.load();
	bgm.loop = true;

	var yyy = new Audio();
    yyy.src = "media/111.mp3";
	yyy.load();
	yyy.loop = false;

	if(navigator.userAgent.match(/iphone/i)){
		document.addEventListener("WeixinJSBridgeReady",function(){
			bgm.play();
			bgm.pause();
			yyy.play();
			yyy.pause();
		},false);
	}else{
		bgm.play();
		bgm.pause();
		yyy.play();
		yyy.pause();
	}

		//音乐控制
    $('.music-true').click(function(){
        $(this).hide()
        $('.music-false').show();
        bgm.pause();
        
    });
    $('.music-false').click(function(){
        $(this).hide()
        $('.music-true').show();
        bgm.play();
    })
$(function(){
	var js = 0;
	for (var i=0;i<Src.length;i++){
        sucai[i] = new Image();
        sucai[i].onload = function(){
            js = js + 99/Src.length; 
            $('.percent').html( Math.ceil(js)+"%");
            for(var i=0;i<js;i++){
            	$('.q'+i).animate({'opacity':'1'},1000);

            }
        }
        sucai[i].src = Src[i];
    }
    var jishi = setInterval(function(){
        if(js >= 98){
            clearInterval(jishi);
            var yanchi = setTimeout(function(){
            	console.log('start')
                	start();		    
            },1500);
            js = 100;
        }
    },50);
    function start(){
    	$('.percent').hide();
    	getsrc(Src);
    	$('.p1').show();
    	bgm.play();
    }
    function getsrc(obj){
		for(var i=0;i<obj.length;i++){
			$('.'+obj[i].replace("images/","").replace(".png","")).attr('src',obj[i]);
		}
	}
})
	var nid=(function(){
		var result = location.search.match(new RegExp("[\?\&]" + "nid"+ "=([^\&]+)","i"));
		if(result == null || result.length < 1){
			return "";
		}
		return result[1];
	})();
	var headimgurl;
	var nickname;
	var chou = 202;
	$.ajax({
		type:"POST",
		url:"http://h5.houjt.com/userproject/newhope/common/controllers/userinformation.php?command=4",
		data:{nid:nid},
		dataType:"json",
		success: function(res){
			headimgurl = res.headimgurl;
			nickname = res.nickname;
			$('.wx_name').html('你好，'+nickname);
			$('.p5-0').attr('src',headimgurl);
		}

	})
	/*点击开启*/
	$('.p1-5').click(function(){
		$('.p1').fadeOut(1000);
		$('.p2').show();
	})
	/*点击去选图*/
	$('.p2-1').click(function(){
		$('.p2').fadeOut(1000);
		$('.p3').show();
	})
	/*跳转到拼图*/
	var check=[false,false,false,false,false,false,false,false,false,false];
	var arr = [2,4,1,6,0,5,8,3,7];
	var finish = 0;
	$('.p3 div span').click(function(){
		for(var i=0;i<12;i++){
			$('.t'+i).attr('src','images/t'+($(this).index()+1)+'-'+i+'.png')
		}
		$('.p3').fadeOut(1000);
		$('.p4').show();
		var timer1
		var a =3;
		$('.p4 .num').show();
		timer1 = window.setInterval(function(){
			if(a>0){
				$('.p4 .num').attr('src','images/p4-'+ a +'.png');
			}else{
				arr = arr.sort(randomsort).sort(randomsort);
				check=[false,false,false,false,false,false,false,false,false,false];
				finish = 0;
				console.log(arr.sort(randomsort).sort(randomsort));

				$('.p4 .num').hide();
				$('.p4-box .mask').show();
				$('.p4 .info_box').show();
				$('.t10').show();
				$('.suipian').css({'top':'120%','left':'5%'});
				$('.suipian').eq(arr[finish]).show();
				move();
				console.log("show:"+arr[finish]);
				window.clearInterval(timer1);
				gaming = window.setInterval(game,1000);

			}
		a--;
	},1000)
	});
	//游戏时间
	var gaming;
	var gametime = 18;//秒
	function game(){
		if(gametime>=0){
			gametime--;
			$('.remain').css('width',gametime/0.18+'%');
		}else{
			window.clearInterval(gaming);
			if(!check[10]){
				$('.t10').hide();
				$('.success').hide();
				$('.fail').show();
				$('.suipian').hide();
				for(var i=finish;i<9;i++){
					$('.suipian').eq(arr[finish]).hide();
				}
			}
		}
		
	}
	//生成随机数组
	function randomsort(){
		return Math.random()>.5?-1:1;
	}
	

	/*点击开始*/
	/*拼图位置[top,left]*/
	var wwidth=$('body').width()*0.94;
	var wheight = $('body').height()*0.45;
	var add=[[0,0],[0,0.331*wwidth],[0,0.615*wwidth],[0.284*wheight,0],[0.33*wheight,0.285*wwidth],[0.284*wheight,0.665*wwidth],[0.66*wheight,0],[0.615*wheight,0.335*wwidth],[0.665*wheight,0.615*wwidth]]

	//移动
	$(document).on(touchmove,function(e){
		e.preventDefault();
	})
	var downX;
	var downY;
	var itX;
	var itY;
	var itwidth;
	var itheight;
	
	var winwidth = $('body').width();
	var winheight = $('body').height();

	var boxleft = $('.p4-box').offset().left;
	var boxtop = winheight*0.22;
	var boxleft= winwidth*0.3;

	$('.suipian').css({'top':'120%','left':'5%'});

	var itX,itY,downX,downY,itwidth,itheight;
	function move(){
		$('.suipian').off(touchstart);
		$('.suipian').off(touchmove);
		$('.suipian').off(touchend);
		$('.suipian').on(touchstart,function(e){
			$(this).css('z-index',10000);
			itX = $(this).offset().left;
			itY = $(this).offset().top;
			downX = e.changedTouches[0].pageX;
			downY = e.changedTouches[0].pageY;
			itwidth = $(this).width();
			itheight = $(this).height();
			console.log('start');
		
			$(this).on(touchmove,function(e){
				cX = e.changedTouches[0].pageX-downX;
				tW = e.changedTouches[0].pageX-downX+itwidth+itX;
				if(cX+itX+boxleft>=0&&tW<=winwidth){
					$(this).css('left',cX+itX);
				}
				cY =e.changedTouches[0].pageY-downY;
				tH =  e.changedTouches[0].pageY-downY+itheight+itY-2*boxtop;
				
				if(cY+itY>=0&&tH<winheight){
					$(this).css('top',itY-boxtop+cY);
				}
				
			})
			$(this).on(touchend,function(){
				$(this).css('z-index',0);
				calX = add[$(this).index()-2][1];
				calY = add[$(this).index()-2][0];
				nowX = $(this).offset().left;
				nowY = $(this).offset().top;
				if((nowY-calY)*(nowY-calY) + (nowX-calX)*(nowX-calX) < 1.5*(boxleft*boxleft + boxtop*boxtop)){
					$(this).css({'top':calY,left:calX});
					//出现下一个
					$(this).off(touchstart);
					$(this).off(touchmove);
					$(this).off(touchend);
					finish++;
					$('.suipian').eq(arr[finish]).show();
					
					//检测是否完成
					check[$(this).index()-2] = true;
					for(var i=0;i<9;i++){
						if(!check[i]){
							check[10] = false;
							return;
						}
						check[10] = true;
					}
					if(check[10]){
						window.clearInterval(gaming);
						$('.t10').hide();
						$('.success').show();
						$('.fail').hide();
						chou = 404;
						$('.suipian').hide();
						$('.p4 .mask').hide();
					}
				}else{
					$(this).css({'top':'120%','left':'5%'});
				}
			})
		})
	}
	
		//抽奖
		var tr = false;
		function cg(){
			console.log('cg**************');
			if(chou==404){
				$('.p6').show();
				tr=true;
			}else{
				console.log('303');
			}	
		}
		//分享
		$('.p5-3').click(function(){
			$('.p5').show();
		})
		//重玩
		$('.p5-2').click(function(){
			$('.p5').hide();
			$('.p4').hide();
			$('.p3').show();
			$('.fail').hide();
			$('.success').hide();
			$('.suipian').hide();
			$('.remain').css('width','100%');
			$('.p4 .num').attr('src','images/p4-3.png');
			gametime = 15;
		})

		//摇一摇抽奖

//运动事件监听
if (window.DeviceMotionEvent) {
    window.addEventListener('devicemotion',deviceMotionHandler,false);
}

//获取加速度信息
//通过监听上一步获取到的x, y, z 值在一定时间范围内的变化率，进行设备是否有进行晃动的判断。
//而为了防止正常移动的误判，需要给该变化率设置一个合适的临界值。
var stopit = false;
var SHAKE_THRESHOLD = 4000;
var last_update = 0;
var x, y, z, last_x = 0, last_y = 0, last_z = 0;
function deviceMotionHandler(eventData) {
        var acceleration =eventData.accelerationIncludingGravity;
        var curTime = new Date().getTime();
        if ((curTime-last_update)> 10) {
            var diffTime = curTime -last_update;
            last_update = curTime;
            x = acceleration.x;
            y = acceleration.y;
            z = acceleration.z;
            var speed = Math.abs(x +y + z - last_x - last_y - last_z) / diffTime * 10000;

            if (speed > SHAKE_THRESHOLD&&tr&&!stopit) {
            	yyy.play();
            	stopit = true;
                $.ajax({
					type:"POST",
					url:"http://h5.houjt.com/userproject/newhope/common/controllers/userinformation.php?command=6",
					data:{nid:nid},
					dataType:"json",
					success: function(res){
		
						if(res.pid==4){
							$('section').hide();
							$('.p0').show();
							$('.p7').show();
							hongbao = res.tmoney;
							$('.money_num').html(hongbao+'<span> 元</span>')
						}else if(res.pid==0){
							$('section').hide();
							$('.p0').show();
							$('.p9').show();
						}else if(res.pid==1){
							$('section').hide();
							$('.p0').show();
							$('.p8').show();
							$('.pj').hide();
							$('.p8-3').show();
						}else if(res.pid==2){
							$('section').hide();
							$('.p0').show();
							$('.p8').show();
							$('.pj').hide();
							$('.p8-4').show();
						}else if(res.pid==3){
							$('section').hide();
							$('.p0').show();
							$('.p8').show();
							$('.pj').hide();
							$('.p8-5').show();
						}
					}
				})
            }
            last_x = x;
            last_y = y;
            last_z = z;
        }
}
	//红包
	$('.p7-2').click(function(){
		$(this).hide();
		$('.p7-1').hide();
		$('.p7-6').show();
		$('.money_num').show();
	})
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?927e44f0460c21ce8c37693f500d80ba";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>
</html>